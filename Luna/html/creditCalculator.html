<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Credit Calculator - Luna</title>
  <link rel="stylesheet" href="../css/main.css">
</head>
<body>

  <div class="calculator-header">
    <div class="header-left">
      <img class="extensionIcon" src="../icons/logo.png" alt="Luna Icon">
      <h1 id="extensionTitle">Luna</h1>
    </div>
    <a href="../html/mainMenu.html?fromBack=true" class="back-button" title="Back to Main Menu">‚Üê Back</a>
  </div>

  <div id="creditCalculatorPage" class="page-container">

    <!-- NEW: View Toggle Buttons -->
    <div class="main-menu-toggle-buttons">
      <button id="singleLineToggleBtn" class="toggle-button selected" data-view="single">Single Line</button>
      <button id="multiLineToggleBtn" class="toggle-button" data-view="multi">Multi Line</button>
    </div>

    <!-- This card is now at the top for both views -->
    <div class="card" id="card-credit-options">
      <div class="card-header">
        <span class="card-header-title">Date Calculation</span>
        <div class="card-header-actions">
          <button class="collapse-toggle" title="Toggle Section">‚ñº</button>
          <div class="help-icon">?
            <span class="tooltip">Choose the date to calculate all credit from. This applies to both Single and Multi Line modes.</span>
          </div>
        </div>
      </div>
      <div class="card-content">
        <div class="integrations-section">
          <label>Calculate From</label>
          <div class="toggle-buttons">
            <button id="calcFromTodayBtn" class="toggle-button selected" data-type="today">Today</button>
            <button id="calcFromCustomBtn" class="toggle-button" data-type="custom">Custom</button>
          </div>
        </div>
        <div id="calculationDateContainer">
          <div id="todaysDateDisplay" class="display-group">
            <label>Today's Date:</label>
            <div class="display-box" id="todaysDateValue">N/A</div>
          </div>
          <div id="customDateGroup" class="input-group hidden">
            <label for="calculationDateInput">Calculation Date:</label>
            <input type="text" id="calculationDateInput" placeholder="mm/dd/yyyy">
          </div>
        </div>
      </div>
    </div>

    <!-- Container for Single Line View -->
    <div id="singleLineContainer">
      <div class="card" id="card-credit-inputs">
        <div class="card-header">
          <span class="card-header-title">License Information</span>
          <div class="card-header-actions">
            <button class="collapse-toggle" title="Toggle Section">‚ñº</button>
            <div class="help-icon">?
              <span class="tooltip">Enter the original license amount ($) and the date the license was purchased.</span>
            </div>
          </div>
        </div>
        <div class="card-content">
          <div class="input-group">
            <label for="creditAmountInput">*Amount:</label>
            <input type="text" id="creditAmountInput" inputmode="decimal" placeholder="$0.00">
          </div>
          <div class="input-group">
            <label for="purchaseDateInput">*Date of Purchase:</label>
            <input type="text" id="purchaseDateInput" placeholder="mm/dd/yyyy">
          </div>
          <div id="singleLineDurationSection" class="integrations-section">
            <label>License Duration</label>
            <div class="toggle-buttons">
              <button id="duration1yr" class="toggle-button selected" data-years="1">1yr</button>
              <button id="duration2yr" class="toggle-button" data-years="2">2yr</button>
              <button id="duration3yr" class="toggle-button" data-years="3">3yr</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Container for Multi Line View -->
    <div id="multiLineContainer" class="hidden">
      <div class="card" id="card-credit-multi-inputs">
        <div class="card-header">
          <span class="card-header-title">Line Items</span>
           <div class="card-header-actions">
            <button class="collapse-toggle" title="Toggle Section">‚ñº</button>
          </div>
        </div>
        <div class="card-content">
          <div id="lineItemsContainer">
            <!-- Line items will be dynamically inserted here by JS -->
          </div>
          <button id="addLineBtn" class="add-line-button" title="Add New Line">+</button>
        </div>
      </div>
    </div>

    <!-- Template for a Multi-Line Item -->
    <template id="lineItemTemplate">
      <div class="line-item">
        <button class="delete-line-btn" title="Delete Line">üóëÔ∏è</button>
        <div class="input-group">
          <label>Name (Optional)</label>
          <input type="text" class="line-name">
        </div>
        <div class="input-group">
          <label>*Amount</label>
          <input type="text" class="line-amount" inputmode="decimal" placeholder="$0.00">
        </div>
        <div class="input-group">
          <label>*Start Date</label>
          <input type="text" class="line-start-date" placeholder="mm/dd/yyyy">
        </div>
        <div class="line-item-row">
          <div class="input-group">
            <label>License Duration</label>
            <select class="line-duration">
              <option value="1">1yr</option>
              <option value="2">2yr</option>
              <option value="3">3yr</option>
              <option value="4">4yr</option>
              <option value="5">5yr</option>
            </select>
          </div>
          <div class="input-group">
            <label>End Date</label>
            <input type="text" class="line-end-date" placeholder="mm/dd/yyyy">
          </div>
        </div>
        <div class="display-group">
          <label>Credit Remaining</label>
          <div class="line-credit-display display-box credit-highlight">$0.00</div>
        </div>
      </div>
    </template>

    <div class="card" id="card-credit-results">
      <div class="card-header">
        <span class="card-header-title">Final Credit</span>
        <div class="card-header-actions">
          <button class="collapse-toggle" title="Toggle Section">‚ñº</button>
          <div class="help-icon">?
            <span class="tooltip">
              This section summarizes the total credit from all lines and calculates the final price after applying it to a new license cost.
            </span>
          </div>
        </div>
      </div>
      <div class="card-content">
        <div id="expirationDateDisplay" class="display-group">
          <label>Expiration Date (Single Line)</label>
          <div class="display-box" id="expirationDateValue">N/A</div>
        </div>
        <div id="daysRemainingDisplay" class="display-group">
          <label>Days Remaining (Single Line)</label>
          <div class="display-box" id="daysRemainingValue">N/A</div>
        </div>
        <div id="creditPerDayDisplay" class="display-group advanced-display hidden">
          <label>Credit per Day (Single Line Only) <span class="advanced-tag"></span>:</label>
          <div class="display-box" id="creditPerDayValue">$0.00</div>
        </div>
        <div class="display-group">
          <label>Total Credit Remaining:</label>
          <div class="display-box-with-button">
              <span id="totalCreditValue">$0.00</span>
              <button id="copyCreditBtn" class="action-button-inside" title="Copy Amount">üìã</button>
          </div>
        </div>
      </div>
    </div>

    <div class="card" id="card-credit-upgrade">
      <div class="card-header">
        <span class="card-header-title">Upgrade / Consolidation</span>
        <div class="card-header-actions">
          <button class="collapse-toggle" title="Toggle Section">‚ñº</button>
          <div class="help-icon">?
            <span class="tooltip">
              Enter the cost original cost of the new updated / consolidated license. The calculator will automatically subtract the remaining credit to show the final amount the customer owes.<br><br>
              <b>Formula:</b> [New License Cost] - [Total Credit Remaining]
            </span>
          </div>
        </div>
      </div>
      <div class="card-content">
        <div class="input-group">
          <label for="newLicenseCostInput">Original Total Cost:</label>
          <input type="text" id="newLicenseCostInput" inputmode="decimal" placeholder="$0.00">
        </div>
        <div class="display-group">
          <label>Final Price w/ Prorated Credit:</label>
          <div class="display-box-with-button">
              <span id="whatTheyOweValue">$0.00</span>
              <button id="copyOwedBtn" class="action-button-inside" title="Copy Amount">üìã</button>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div id="calculatorFooter" class="calculator-footer-bar">
    <button id="clearAllBtn" class="footer-button clear-button">üóëÔ∏è Clear All</button>
  </div>

  <script type="module" src="../js/creditCalculator.js"></script>
  <script type="module" src="../js/utils.js"></script>
</body>
</html>